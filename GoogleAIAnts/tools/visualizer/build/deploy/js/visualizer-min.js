function o(a){throw a;}var u=void 0,w=null,y;Img={EMPTY:26,gb:27};Quality={O:!1,Kb:!0};function aa(a,b){this.id=a;this.ea=[new z];this.ea[0].o=b;this.va=[new B];this.va[0].o=b;this.Fb=u;this.Va=new z;this.Va.id=a;this.Ua=new B;this.Ua.id=a;this.Cb=[];this.wb=[]}
function C(a,b,c){for(var a=c?a.va:a.ea,d,h=a.length-1;h>=0;h--)if(a[h].o==b)return a[h];else if(a[h].o<b)return h===a.length-1?c=c?new B(a[h]):new z(a[h]):(c=c?new B:new z,d=(b-a[h].o)/(a[h+1].o-a[h].o),c.Y(a[h],a[h+1],d)),c.o=b,a.splice(h+1,0,c),c;return w}
aa.prototype.Y=function(a,b){var c,d,h,e,f,j,l,k;b?(e=this.va,f=this.Ua,j=this.wb):(e=this.ea,f=this.Va,j=this.Cb);if(a<e[0].o)return w;c=e[e.length-1];if(a>=c.o)return f.assign(c);l=a|0;k=j[l];if(k===u){if(l<e[0].o)k=0;else{d=0;h=e.length-1;do c=d+h>>1,l<e[c].o?h=c:l>e[c+1].o?d=c:(k=c,j[l]=c);while(k===u)}j[l]=k}for(;a>e[k+1].o;)k++;return f.Y(e[k],e[k+1],(a-e[k].o)/(e[k+1].o-e[k].o))};
function D(a,b,c,d,h){var e=Quality.O,f,j,l=e?a.va:a.ea;f=C(a,d,e);e=C(a,h,e);for(a=l.length-1;a>=0;a--)if(l[a].o===d)break;f=f[b];for(a++;l[a]!==e;a++)j=(l[a].o-d)/(h-d),l[a][b]=(1-j)*f+j*c;for(;a<l.length;a++)l[a][b]=c}function z(a){a?this.assign(a):(this.size=this.b=this.g=this.r=this.y=this.x=this.o=0,this.owner=u)}
z.prototype.Y=function(a,b,c){var d=1-c;this.o=d*a.o+c*b.o;this.x=a.x===b.x?a.x:d*a.x+c*b.x;this.y=a.y===b.y?a.y:d*a.y+c*b.y;this.r=d*a.r+c*b.r|0;this.g=d*a.g+c*b.g|0;this.b=d*a.b+c*b.b|0;this.size=d*a.size+c*b.size;this.owner=a.owner;return this};z.prototype.assign=function(a){this.o=a.o;this.x=a.x;this.y=a.y;this.r=a.r;this.g=a.g;this.b=a.b;this.size=a.size;this.owner=a.owner;return this};
function B(a){this.o=a?a.o:0;this.x=a?a.x:0;this.y=a?a.y:0;this.Pa=a?a.Pa:Math.random()*2*Math.PI;this.zb=a?a.zb:Img.EMPTY;this.Ab=a?a.Ab:Img.gb;this.Jb=a?a.Jb:0}B.prototype.Y=function(a,b){var c=new B;c.o=(1-b)*this.o+b*a.o;return c};function E(){this.Ea={};this.eb=0}E.prototype.add=function(a){this.Ea[this.eb]=a;return this.eb++};E.prototype.qb=function(a){var b=this.Ea[a];b?(delete this.Ea[a],b.Zb(a)):alert("no applet with token: "+a+" in list")};E.prototype.rb=function(a,b){for(var c=Array(arguments.length-2),d=0;d<c.length;d++)c[d]=arguments[d+2];window.setTimeout(function(){a[b].apply(a,c)},0)};appletManager=new E;E.prototype.callAfterExecutionUnit=E.prototype.rb;E.prototype.appletInitialized=E.prototype.qb;LoadingState={IDLE:0,LOADING:1,Ja:2};Key={jb:37,ob:39,pb:32,mb:33,lb:34,hb:36,fb:35,nb:187,kb:189};function Location(a,b,c,d){this.x=a;this.y=b;this.d=c;this.e=d}Location.prototype.contains=function(a,b){return a>=this.x&&a<this.x+this.d&&b>=this.y&&b<this.y+this.e};
Visualizer=function(a,b,c,d,h,e){this.R=a;this.map={};this.border={};this.aa={};this.I={};this.fa=u;this.d=d;this.e=h;this.c={};this.scale=u;this.options={};this.options.data_dir=b;this.options.interactive=c!==!1;var f,d=window.location.href;if((c=d.indexOf("?"))!==-1){d=d.substr(c+1).split("#")[0].split("&");for(c=0;c<d.length;c++)a=d[c].indexOf("="),f=d[c].substr(0,a),a=d[c].substr(a+1),f==="debug"||f==="profile"||f==="interactive"?a=a=="true"||a=="1":f==="row"||f==="col"||f==="turn"?(a=parseInt(a),
a>=0||(a=0)):f==="config"&&(e=JSON.parse(unescape(a))),this.options[f]=a}if(this.options.row!==u&&this.options.col!==u)e||(e={}),e.zoom=20;this.n=new F(e);this.k=new ba(this);this.P=this.N=-1;this.B=0;this.la=!1;this.Ya=this.Xa=this.L=this.K=0;this.m=new G(this);this.log=document.createElement("div");e="Loading visualizer...";e+="<table>";for(f in this.options)a=this.options[f],e+="<tr><td>-&nbsp;</td><td>"+f+"&nbsp;&nbsp;</td><td><b>"+a+"&nbsp;&nbsp;</b></td><td><i>",f=="data_dir"&&(e+="(Image directory)"),
e+="</i></td></tr>";for(e+="</table>";this.R.hasChildNodes();)this.R.removeChild(this.R.lastChild);this.log.innerHTML=e;this.R.appendChild(this.log);this.u=new H((b||"")+"img/",this,this.tb);this.u.add("water.png");this.u.add("mud.jpg");this.u.add("ant.png");this.u.add("playback.png");this.u.add("fog.png");this.u.add("toolbar.png");this.u.add("food.png");this.u.add("rank.png");this.u.add("graph_options.png");this.Ra=0;this.a=u;this.j={};this.F={};this.hint="";this.A=u;this.da=!1;this.W=LoadingState.IDLE;
ca(this.u)};function I(a,b,c){a.W===LoadingState.LOADING&&(b&&da(a,b),window.setTimeout(function(){try{c()}catch(b){typeof b=="string"&&(b={message:b});var h="",e;for(e in b){var f=(new String(b[e])).replace("&","&amp;"),f=f.replace("<","&lt;").replace(">","&gt;");h+="<p><u><b>Error "+e+":</b></u>\n"+f+"</p>"}J(a,h);e=h=0;f=a.log;if(a.log.offsetParent){do h+=f.offsetLeft,e+=f.offsetTop;while(f=f.offsetParent)}window.scrollTo(h,e)}},50))}
function da(a,b){b=b.replace(/\n/g,"<br>");a.log.innerHTML+=b+"<br>"}function J(a,b){da(a,'<font color="red">'+b+"</font>");a.ba()}y=Visualizer.prototype;y.ba=function(){this.W=LoadingState.Ja;this.u.ba();this.k.ba();this.a&&this.a instanceof XMLHttpRequest&&this.a.abort();this.a=u;this.j.canvas&&this.R.firstChild===this.j.canvas&&this.R.removeChild(this.j.canvas);this.A=u;this.da=!1;document.onkeydown=w;document.onkeyup=w;document.onkeypress=w;window.onresize=w;this.log.style.display="block"};
function ea(a){if(a.W!==LoadingState.IDLE)return!0;a.log.innerHTML="";a.ba();a.W=LoadingState.LOADING;return!1}
y.Eb=function(a){if(!ea(this)){var b=this;I(this,"Fetching replay from: <i>"+a+"</i>...",function(){b.a=new XMLHttpRequest;b.a.onreadystatechange=function(){if(b.a.readyState===4&&b.W===LoadingState.LOADING)b.a.status===200?(b.a=""+b.a.responseText,fa(b)):J(b,"Status "+b.a.status+": "+b.a.statusText)};b.a.open("GET",a);b.options.debug&&b.a.setRequestHeader("Cache-Control","no-cache");b.a.send();ga(b)})}};y.Db=function(a){if(!ea(this))this.a=a,ga(this)};
function fa(a){I(a,"Parsing the replay...",function(){if(a.a)if(a.a instanceof ha)return;else if(typeof a.a=="string")a.a=new ha(a.a,a.options.debug,a.options.user);else if(a.a instanceof XMLHttpRequest)return;else o(Error("Something unknown is in the replay variable: "+a.a));else a.W!==LoadingState.Ja&&o(Error("Replay is undefined."));ia(a)})}
function ga(a){I(a,"Creating canvas...",function(){if(!a.j.canvas)a.j.canvas=document.createElement("canvas");var b=a.j.canvas;a.j.i=b.getContext("2d");a.R.firstChild!==b&&a.R.insertBefore(b,a.log);K(a.map);K(a.border);K(a.aa);K(a.I);K(a.F);ia(a)})}y.tb=function(a){a?J(this,a):ia(this)};
function ia(a){var b,c,d=a;if(a.a!==u)if(a.a instanceof ha){if(a.j.i&&!a.u.error&&!a.u.xa){d=a;if(a.options.interactive){if(!d.m.p.playback){if(a.a.J)b=d.m.p.playback=new L(d.m,d.u.images[3],la,M,2,0),b.z(3,function(){N(d.k,0)},"jump to start of first turn"),O(b,32),b.z(5,function(){c=(Math.ceil(d.k.position*2)-1)/2;na(d.k,c)},"play one move/attack phase backwards"),O(b,64),b.z(4,function(){var a=d.k;a.C!==0?a.stop():a.play()},"play/stop the game"),O(b,64),b.z(6,function(){na(d.k,(Math.floor(d.k.position*
2)+1)/2)},"play one move/attack phase"),O(b,32),b.z(2,function(){N(d.k,d.k.duration)},"jump to end of last turn");b=d.m.p.toolbar=new L(d.m,d.u.images[5],oa,M,2,0);pa()&&b.z(0,function(){d.n.save()},"save and reuse the current settings");(!window.ka||window.ka())&&b.z(1,function(){d.ma(!d.n.fullscreen)},"toggle fullscreen mode");b.z(2,function(){qa(d,2*d.n.zoom);d.k.l()},"zoom in");b.z(3,function(){qa(d,0.5*d.n.zoom);d.k.l()},"zoom out");b.z(4,function(){d.K=d.Xa;d.L=d.Ya;var a=P(d.m.p.toolbar,4);
a.enabled=!1;a.l();d.k.l()},"center the map").enabled=!1;b.z(5,function(){d.n.label=(d.n.label+1)%3;d.k.l()},"toggles: 1. player letters on ants, 2. global ids on ants");a.a.J&&(b.z(6,function(){d.n.speedFactor+=1;ra(d)}),b.z(7,function(){d.n.speedFactor-=1;ra(d)}))}for(var h=["#532"],e=0;e<a.a.s;e++)h.push(a.a.h.playercolors[e]);if(a.Ra<a.a.s)a.Ra=a.a.s,sa(a.u,4,h),sa(a.u,2,h);if(a.a.J){b=a.m.p.fog=new L(a.m,a.u.wa[4],oa,Q,2,u);for(var f=function(a){return b.z(e,function(){var b=d;a===u?(b.A=u,ta(b,
b.k.position|0)):b.A={bb:a};b.k.l()},e==0?"clear fog of war":"show fog of war for "+d.a.h.playernames[e-1])},e=0;e<h.length;e++)e==0?f(u).G=!0:f(e-1)}}a.a.J&&ua(a);a.k.duration=a.a.duration;ra(a);if(a.options.interactive)a.k.$=function(){var a=d.m.p.playback.v[4];a.ab=(d.k.C!==0?7:4)*d.u.images[3].height;if(a===d.m.Q)d.m.Q=w;a.U()},document.onkeydown=function(a){if(!a)a=window.event;var b=d,a=a.keyCode,c=b.k;switch(a){case Key.pb:c.C!==0?c.stop():c.play();break;case Key.jb:N(c,Math.ceil(c.position)-
1);break;case Key.ob:N(c,Math.floor(c.position)+1);break;case Key.mb:N(c,Math.ceil(c.position)-10);break;case Key.lb:N(c,Math.floor(c.position)+10);break;case Key.hb:N(c,0);break;case Key.fb:N(c,c.duration);break;case Key.nb:P(b.m.p.toolbar,6).onclick();break;case Key.kb:P(b.m.p.toolbar,7).onclick();break;default:switch(String.fromCharCode(a)){case "F":b.ma(!b.n.fullscreen)}}};a.j.canvas.onmousemove=function(a){var b=0,c=0,e=this;if(this.offsetParent){do b+=e.offsetLeft,c+=e.offsetTop;while(e=e.offsetParent)
}b=(a||window.event).clientX-b+(window.scrollX===u?document.body.parentNode.scrollLeft!==u?document.body.parentNode.scrollLeft:document.body.scrollLeft:window.scrollX);c=(a||window.event).clientY-c+(window.scrollY===u?document.body.parentNode.scrollTop!==u?document.body.parentNode.scrollTop:document.body.scrollTop:window.scrollY);va(d,b,c)};a.j.canvas.onmouseout=function(){var a=d;a.m.Z(-1,-1);a.m.U();a.B=0};a.j.canvas.onmousedown=function(){a:{var a=d;if(a.options.interactive){if(a.a.J&&a.c.H.contains(a.N,
a.P))a.B=1;else if(a.n.zoom!==1&&a.F.c.contains(a.N,a.P))a.B=3;else if(a.c.f.contains(a.N,a.P))a.B=2;else{a.m.B();break a}va(a,a.N,a.P)}else a.m.B()}};a.j.canvas.onmouseup=function(){var a=d;a.B=0;a.m.U();va(a,a.N,a.P)};window.onresize=function(){wa(d)};if(a.options.row!==u&&a.options.col!==u)a.K=a.Xa=(0.5*a.a.cols-0.5)*20-a.options.col%a.a.cols*20,a.L=a.Ya=(0.5*a.a.rows-0.5)*20-a.options.row%a.a.rows*20;a.log.style.display="none";a.W=LoadingState.IDLE;a.ma(a.n.fullscreen);a.a.J&&(a.options.turn?
N(a.k,a.options.turn-1):a.k.play())}}else a.a instanceof XMLHttpRequest||fa(a)}
function ua(a){function b(b){var c=a.a.M[b],d=w;a.a.h.user_url&&a.a.h.user_ids&&a.a.h.user_ids[b]!==u&&(d=function(){window.location.href=a.a.h.user_url.replace("~",a.a.h.user_ids[b])});var e=a.a.h.playernames[b],e=f[b]+". "+e;a.a.h.status&&(e+=" ("+xa(a,b)+")");h.z(e,c,d)}var c,d,h=a.m.p.players=new R(a.m,ya,M,2),e=a.a.h.game_id||a.options.game;a.a.h.game_url&&e!==u&&(c=function(){window.location.href=a.a.h.game_url.replace("~",e)});e===u?h.z("Players:","#000",c):h.z("Game #"+e+":","#000",c);if(a.a.h.replaydata.bonus){c=
Array(a.a.s);for(d=0;d<a.a.s;d++)c[d]=a.a.I[a.a.duration][d],c[d]+=a.a.h.replaydata.bonus[d]}else c=a.a.I[a.a.duration];var f=Array(c.length),j=Array(c.length);for(d=0;d<c.length;d++){f[d]=1;for(var l=0;l<c.length;l++)c[d]<c[l]&&f[d]++;for(l=f[d]-1;j[l]!==u;)l++;j[l]=d}for(d=0;d<a.a.s;d++)b(j[d])}
function ra(a){function b(a){return"set speed modifier to "+(a>0?"+"+a:a)}var c=a.k.duration/a.n.duration,c=Math.max(c,a.n.speedSlowest),c=Math.min(c,a.n.speedFastest);a.k.Fa=c*Math.pow(1.5,a.n.speedFactor);if(a.k.C!==0)a.k.C=a.k.Fa;if(a.options.interactive&&a.a.J)P(a.m.p.toolbar,6).hint=b(a.n.speedFactor+1),P(a.m.p.toolbar,7).hint=b(a.n.speedFactor-1)}function K(a){if(!a.canvas)a.canvas=document.createElement("canvas");if(!a.i)a.i=a.canvas.getContext("2d")}
y.ma=function(a){if(!window.ka||window.ka())if(window.ma)this.n.fullscreen=window.ma(a);else if((this.n.fullscreen=a)||this.za){var b=document.getElementsByTagName("html")[0];if(a)this.R.removeChild(this.j.canvas),this.Hb=b.style.overflow,b.style.overflow="hidden",a=document.createElement("body"),a.appendChild(this.j.canvas),this.za=b.replaceChild(a,document.body);else if(this.za)document.body.removeChild(this.j.canvas),this.R.appendChild(this.j.canvas),b.replaceChild(this.za,document.body),b.style.overflow=
this.Hb,delete this.za}wa(this,!0)};
function qa(a,b){var c=a.scale,b=Math.max(1,b);a.n.zoom=b;a.scale=Math.max(1,Math.min((a.c.f.d-20)/a.a.cols,(a.c.f.e-20)/a.a.rows))|0;a.scale=Math.min(20,a.scale*b);if(c)a.K=a.K*a.scale/c|0,a.L=a.L*a.scale/c|0;a.c.map=new Location(0,0,a.scale*a.a.cols,a.scale*a.a.rows);a.c.map.x=(a.c.f.d-a.c.map.d)/2+a.c.f.x|0;a.c.map.y=(a.c.f.e-a.c.map.e)/2+a.c.f.y|0;a.map.canvas.width=a.c.map.d;a.map.canvas.height=a.c.map.e;za(a,a.map.i,a.scale);a.aa.canvas.width=Math.min(a.c.map.d,a.c.f.d);a.aa.canvas.height=Math.min(a.c.map.e,
a.c.f.e);a.border.canvas.width=Math.min(a.c.f.d,a.c.map.d);a.border.canvas.height=Math.min(a.c.f.e,a.c.map.e);if(a.options.interactive)c=P(a.m.p.toolbar,2),c.enabled=a.scale!==20,c.l(),c=P(a.m.p.toolbar,3),c.enabled=b!==1,c.l()}
function wa(a,b){var i;var c,d,h={width:a.j.canvas.width,height:a.j.canvas.height};d={};if(typeof window.innerWidth=="number")d.width=window.innerWidth,d.height=window.innerHeight;else if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight))d.width=document.documentElement.clientWidth,d.height=document.documentElement.clientHeight;var e=window.ka&&!window.ka()||!a.n.fullscreen;d.width=a.d&&e?a.d:d.width;d.height=a.e&&e?a.e:d.height;if((h=d.width!=
h.width||d.height!=h.height)||b){var e=a.j.canvas,f=a.j.i;if(h)e.width=d.width,e.height=d.height,f.fillStyle="#fff",f.fillRect(0,0,e.width,e.height);f.font="bold 19px Arial,Sans";f.textAlign="left";f.textBaseline="middle";if(a.a.J){var j=a.m.p.players;j.d=d.width;for(var l=0,k=0,g=0;g<j.v.length;g++)c=j.v[g],l&&l+c.d>j.d&&(l=0,k+=c.e+2),c.x=l,c.y=k,l+=c.d+2;i=(j.e=c?k+c.e:0)+4,c=i;a.c.H=new Location(4,c+66,d.width-8,64);a.c.Ib=new Location(95,c+4,d.width-4-95,22);a.c.ub=new Location(95,c+38,d.width-
4-95,22);h?(f.strokeStyle="#444",f.lineWidth=2,Aa(f,0,c,e.width,30,5),f.stroke(),Aa(f,0,c+34,e.width,100,5),f.moveTo(0,c+63),f.lineTo(e.width,c+63),f.stroke(),f.lineWidth=1,f.fillStyle="#888",f.fillText("scores",4,c+14),f.fillText("# of ants",4,c+48)):(f.fillStyle="#fff",f.fillRect(0,0,e.width,c));c+=134}else c=0;if(a.options.interactive){a.a.J?(a.c.f=new Location(40,c,d.width-40-48,d.height-c-64),h=a.m.p.playback,c=512,h.x=c<=d.width?(d.width-c)/2|0:0,h.y=a.c.f.y+a.c.f.e,h=a.m.p.fog,h.y=a.c.f.y+
8):a.c.f=new Location(0,c,d.width-48,d.height-c);h=a.m.p.toolbar;h.x=a.c.f.x+a.c.f.d;h.y=a.c.f.y+8;if(a.a.J)h=a.m.p.fog,h.e=d.height-a.c.f.y-8,h=a.m.p.playback,h.d=d.width-96;h=a.m.p.toolbar;h.e=d.height-a.c.f.y-8}else a.c.f=new Location(0,c,d.width,d.height-c);qa(a,a.n.zoom);c=Math.min(a.c.f.d,a.c.map.d);d=Math.min(a.c.f.e,a.c.map.e);if(a.border.canvas.width!==c||a.border.canvas.height!==d)a.border.canvas.width=c,a.border.canvas.height=d;if(a.a.J){a.I.canvas.width=a.c.H.d;a.I.canvas.height=a.c.H.e;
d=a.I.i;c=a.I.canvas.width-1;j=a.I.canvas.height-1;d.fillStyle="#FFF";d.fillRect(0,0,c+1,j+1);h=-Infinity;for(e=0;e<=a.a.duration;e++)for(g=0;g<a.a.S[e].length;g++)h<a.a.S[e][g]&&(h=a.a.S[e][g]);f=c/a.a.duration;d.strokeStyle="rgba(0,0,0,0.5)";d.beginPath();for(e=0;e<=a.a.duration+1;e++)l=e+1,d.moveTo(0.5+f*e,j-(l%100?l%10?3:7:17)),d.lineTo(0.5+f*e,j+1);d.moveTo(0.5,j+0.5);d.lineTo(0.5+f*(a.a.duration+1),j+0.5);d.stroke();j/=h-0;for(e=a.a.s-1;e>=0;e--){d.strokeStyle=a.a.M[e];d.beginPath();d.moveTo(0.5,
0.5+j*(h-a.a.S[0][e]));for(g=1;g<=a.a.duration;g++)d.lineTo(0.5+f*g,0.5+j*(h-a.a.S[g][e]));d.stroke()}if(!a.da&&a.a.h.status){d.font="10px Arial,Sans";for(e=a.a.s-1;e>=0;e--){d.fillStyle=a.a.M[e];d.strokeStyle=a.a.M[e];l=xa(a,e);g=a.a.h.replaydata.scores[e].length-1;d.beginPath();k=0.5+g*f;g=0.5+j*(h-a.a.S[g][e]);d.moveTo(k,g);var q=d.measureText(l).width,m=Math.min(k,c-q);g<30?(g=(g+12|0)+0.5,d.lineTo(k,g-8),d.moveTo(m,g-8),d.lineTo(m+q,g-8)):(g=(g-7|0)+0.5,d.lineTo(k,g+2),d.moveTo(m,g+2),d.lineTo(m+
q,g+2));d.fillText(l,m,g);d.stroke()}}}a.F.c=new Location(a.c.f.x+a.c.f.d-2-a.a.cols,a.c.f.y+2,a.a.cols,a.a.rows);a.F.canvas.width=a.a.cols;a.F.canvas.height=a.a.rows;a.m.l();a.k.l(!0)}}
function za(a,b,c){var d,h,e,f,j,l,k,g,q,m,p,n,r,i,s;if(c===20&&a.n.graphics===!0){b.fillStyle="#fff";b.fillRect(0,0,a.c.map.d,a.c.map.e);l=2*a.a.rows-1;k=2*a.a.cols-1;g=l+a.a.rows+2;q=k+a.a.cols+2;j=a.a.Ca;n=[];for(e=l-1;e<=g;e++){n[e]=[];for(f=k-1;f<=q;f++)n[e][f]=e>=l&&f>=k&&e<g&&f<q&&j[e%a.a.rows][f%a.a.cols]}d=[];for(e=l;e<g;e++){d[e]=[];for(f=k;f<=q;f++)d[e][f]=n[e][f-1]!==n[e][f]}h=[];for(e=l;e<=g;e++){h[e]=[];for(f=k;f<q;f++)h[e][f]=n[e-1][f]!==n[e][f]}r=[];for(e=l;e<=g;e++)for(f=k;f<q;f++)if(h[e][f]){s=
e;i=[];n[e][f]?(p=f,m=0,i.push([p-k-1,s-l-1])):(p=f,m=2,i.push([p-k,s-l-1]));j=0;do{m===0||m===2?h[s][p]=!1:d[s][p]=!1;switch(m){case 0:i.push([i[j][0]+1,i[j][1]]);s>l&&d[s-1][p+1]===!0?(s--,p++,m=1):p+1<q&&h[s][p+1]===!0?(p++,m=0):d[s][p+1]===!0?(p++,m=3):m=-1;break;case 1:i.push([i[j][0],i[j][1]-1]);p>k&&h[s][p-1]===!0?(p--,m=2):s>l&&d[s-1][p]===!0?(s--,m=1):m=h[s][p]===!0?0:-1;break;case 2:i.push([i[j][0]-1,i[j][1]]);s<g&&d[s][p]===!0?m=3:p>k&&h[s][p-1]===!0?(p--,m=2):d[s-1][p]===!0?(s--,m=1):
m=-1;break;case 3:i.push([i[j][0],i[j][1]+1]),p<q&&h[s+1][p]===!0?(s++,m=0):s+1<g&&d[s+1][p]===!0?(s++,m=3):h[s+1][p-1]===!0?(s++,p--,m=2):m=-1}j++}while(m!==-1);r.push(i)}b.shadowBlur=15;b.shadowColor="#000";b.shadowOffsetX=-a.a.cols*c*2;b.beginPath();for(j=0;j<r.length;j++){i=r[j];for(n=0;n<i.length;n++)p=Math.sin(3*i[n][1]^i[n][1]^i[n][0])*c*0.2,s=Math.sin(3*i[n][0]^i[n][0]^i[n][1])*c*0.2,i[n][0]=i[n][0]*c+a.a.cols*c*2+p,i[n][1]=i[n][1]*c+s;b.moveTo(i[i.length-1][0],i[i.length-1][1]);for(n=0;n<
i.length;n++)b.lineTo(i[n][0],i[n][1])}b.fill();s={};K(s);s.canvas.width=b.canvas.width;s.canvas.height=b.canvas.height;s.i.fillStyle=s.i.createPattern(a.u.images[1],"repeat");s.i.fillRect(0,0,s.canvas.width,s.canvas.height);l=s.i.getImageData(0,0,s.canvas.width,s.canvas.height);k=l.data;e=b.getImageData(0,0,s.canvas.width,s.canvas.height);r=e.data;for(j=0;j<4*s.canvas.height*s.canvas.width;j++)r[j]*=2;i=[0,0.8,2];for(e=0;e<s.canvas.height;e++){j=e*4*s.canvas.width;for(f=0;f<s.canvas.width;f++)if(n=
j+4*f,d=r[(e+12)*4*s.canvas.width+(f+12)*4]-r[(e-12)*4*s.canvas.width+(f-12)*4],d!==0||r[n]<254){d*=0.1;g=Math.sin((r[n]/255-0.5)*Math.PI)*0.5+0.5;q=1-g;for(p=0;p<3;p++)k[n+p]+=d,k[n+p]=Math.pow(k[n+p]*(g*g*0.7+0.3),Math.pow(q+1,-0.3)),k[n+p]=Math.min(255,k[n+p]*(g+q*i[p])+20*q*i[p])}}b.putImageData(l,0,0)}else{b.fillStyle="#532";b.fillRect(0,0,a.c.map.d,a.c.map.e);b.fillStyle=b.createPattern(a.u.images[0],"repeat");for(e=0;e<a.a.rows;e++){j=u;for(f=0;f<a.a.cols;f++)p=a.a.Ca[e][f],j===u&&p?j=f:j!==
u&&!p&&(b.fillRect(c*j,c*e,c*(f-j),c),j=u);j!==u&&b.fillRect(c*j,c*e,c*(f-j),c)}}if(a.options.row!==u&&a.options.col!==u)for(j=1;j<=5;j++)b.strokeStyle="rgba(255,0,0,"+j/5+")",n=c+11-2*j,e=a.options.col%a.a.cols*c-5.5+j,f=a.options.row%a.a.rows*c-5.5+j,s=a.a.rows*c,p=a.a.cols*c,b.strokeRect(e+p,f+s,n,n),b.strokeRect(e,f+s,n,n),b.strokeRect(e+p,f,n,n),b.strokeRect(e,f,n,n)}function xa(a,b){var c=a.a.h.status[b];return c==="survived"?"\u2713":c==="eliminated"?"\u2717":a.a.h.status[b]}
function ta(a,b){var c=a.aa.i;c.clearRect(0,0,a.aa.canvas.width,a.aa.canvas.height);if(a.A){if(!a.A.i)K(a.A),a.A.canvas.width=2,a.A.canvas.height=2,a.A.i.fillStyle=a.a.M[a.A.bb],a.A.i.fillRect(0,0,1,1),a.A.i.fillRect(1,1,1,1),a.A.Gb=c.createPattern(a.A.canvas,"repeat");var d=a.c.f,h=a.scale*a.a.rows,e=a.scale*a.a.cols,f=d.e<h?0.5*(a.c.f.e-h)+a.L|0:0,j=d.d<e?0.5*(a.c.f.d-e)+a.K|0:0;c.fillStyle=a.A.Gb;var l=a.scale-1,k;k=a.a;var g=a.A.bb,q,m,p,n,r,i,s,t,v,A,x,ja;m=k.Ta[g];if(m[b]===u){m[b]=p=Array(k.rows);
for(n=0;n<k.rows;n++){p[n]=Array(k.cols);for(r=0;r<k.cols;r++)p[n][r]=!0}s=k.h.replaydata.viewradius2;i=Math.sqrt(s)|0;ja=Ba(k,b);for(q=0;q<ja.length;q++)if((A=ja[q].Y(b,Quality.O))&&A.owner===g){t=Array(2*i+1);for(n=2*i;n>=0;n--)t[n]=A.y-i+n,t[n]-=Math.floor(t[n]/k.rows)*k.rows;v=Array(2*i+1);for(r=2*i;r>=0;r--)v[r]=A.x-i+r,v[r]-=Math.floor(v[r]/k.cols)*k.cols;r=v[i];for(n=1;n<=i;n++)p[t[i-n]][r]=!1,p[t[i+n]][r]=!1;n=p[t[i]];for(r=0;r<v.length;r++)n[v[r]]=!1;for(n=1;n<=i;n++){A=p[t[i-n]];x=p[t[i+
n]];for(r=1;r<=i;r++)n*n+r*r<=s&&(A[v[i-r]]=!1,A[v[i+r]]=!1,x[v[i-r]]=!1,x[v[i+r]]=!1)}}}k=m[b];for(g=0;g<a.a.rows;g++)if(q=k[g],m=g*a.scale+f+l,m-=Math.floor(m/h)*h+l,m<d.e)for(p=0;p<a.a.cols;p++)q[p]&&(r=p*a.scale+j+l,r-=Math.floor(r/e)*e+l,r<d.d&&c.fillRect(r,m,a.scale,a.scale))}}
function Ca(a,b,c,d){var h=0;a.j.i.save();a.j.i.beginPath();a.j.i.rect(b.x,b.y,b.d,b.e);a.j.i.clip();for(var e=0;e<c.length;e++)h+=d?c[e]+d[e]:c[e];var f=Array(c.length);if(h==0){for(e=0;e<c.length;e++)f[e]=1;h=c.length}else for(e=0;e<c.length;e++)f[e]=d?c[e]+d[e]:c[e];for(var h=b.d/h,j=b.x,e=0;e<f.length;e++){var l=h*f[e];a.j.i.fillStyle=a.a.M[e];a.j.i.fillRect(j,b.y,b.d-j+b.x,b.e);j+=l}a.j.i.textAlign="left";a.j.i.textBaseline="top";a.j.i.font="bold 16px Monospace";a.j.i.fillStyle="rgba(0,0,0,0.5)";
l=b.y+3;j=b.x+2;for(e=0;e<f.length;e++){b=Math.round(c[e]);a.n.label===1&&(b=String.fromCharCode(65+e)+":"+b);var k=d&&d[e]?"+"+Math.round(d[e]):"",g=a.j.i.measureText(b).width;if(k){a.j.i.font="bold italic 12px Monospace";var q=a.j.i.measureText(k).width;a.j.i.font="bold 16px Monospace"}else q=0;if(h*f[e]>=g+q&&(a.j.i.fillText(b,j,l),k))a.j.i.font="bold italic 12px Monospace",a.j.i.fillStyle="rgba(0,0,0,0.8)",a.j.i.fillText(k,j+g,l),a.j.i.font="bold 16px Monospace",a.j.i.fillStyle="rgba(0,0,0,0.5)";
j+=h*f[e]}a.j.i.restore()}y.Y=function(a,b,c){if(c===0)return a;for(var d=Array(a.length),h=0;h<d.length;h++)d[h]=(1-c)*a[h]+c*b[h];return d};
y.l=function(a,b){var c,d,h,e,f,j,l,k,g,q;q=a|0;if(this.a.J){var m=this.a.duration;b&&(this.A!==u&&ta(this,q),Ca(this,this.c.Ib,this.a.I[q],q===m?this.a.h.replaydata.bonus:u),Ca(this,this.c.ub,this.a.S[q]));this.j.i.drawImage(this.I.canvas,this.c.H.x,this.c.H.y);c=this.c.H.x+0.5+(this.c.H.d-1)*a/m;this.j.i.lineWidth=1;this.j.i.beginPath();this.j.i.moveTo(c,this.c.H.y+0.5);this.j.i.lineTo(c,this.c.H.y+this.c.H.e-0.5);this.j.i.stroke();this.j.i.fillStyle="#888";this.j.i.textBaseline="middle";this.j.i.fillText("# of ants | "+
(q===m&&!this.da?"end":"turn "+(q+1)+"/"+m),this.c.H.x,this.c.H.y+11)}var p={},m=this.c.f,n=this.scale*this.a.rows,r=this.scale*this.a.cols;m.e<n?(d=0.5*(this.c.f.e-n)+this.L|0,d-=Math.ceil(d/n)*n):d=0;m.d<r?(c=0.5*(this.c.f.d-r)+this.K|0,c-=Math.ceil(c/r)*r):c=0;var i=b!==u&&this.n.zoom!==1;i&&za(this,this.F.i,1);f=Ba(this.a,q);q=Array(f.length);t=0;for(j=f.length-1;j>=0;j--)if(g=f[j].Y(a,Quality.O)){k=S[g.r]+S[g.g]+S[g.b];g.ha=Math.round(g.x);g.ia=Math.round(g.y);g.ha-=Math.floor(g.ha/this.a.cols)*
this.a.cols;g.ia-=Math.floor(g.ia/this.a.rows)*this.a.rows;if(i)this.F.i.fillStyle="#"+k,this.F.i.fillRect(g.ha,g.ia,1,1);g.x=Math.round(this.scale*g.x)+c+this.scale-1;g.y=Math.round(this.scale*g.y)+d+this.scale-1;g.x-=Math.floor(g.x/r)*r+this.scale-1;g.y-=Math.floor(g.y/n)*n+this.scale-1;g.x<m.d&&g.y<m.e&&(p[k]||(p[k]=[]),p[k].push(g),q[t++]=g)}q.length=t;i=this.border.i;for(j=d;j<this.c.f.e;j+=n)for(f=c;f<this.c.f.d;f+=r)i.drawImage(this.map.canvas,f,j);if(this.K||this.L){i.strokeStyle="#000";i.lineWidth=
2;i.beginPath();for(j=d;j<=this.c.f.e;j+=n)i.moveTo(0,j),i.lineTo(this.c.f.d,j);for(f=c;f<=this.c.f.d;f+=r)i.moveTo(f,0),i.lineTo(f,this.c.f.e);i.stroke();i.lineWidth=1}k=0.5*this.scale;for(e in p){i.fillStyle="#"+e;for(var s=p[e],t=0;t<s.length;t++)g=s[t],this.n.graphics&&this.scale===20?(i.save(),i.translate(g.x+k,g.y+k),g.owner===u?(f=this.u.images[6],j=20*(g.id%5)):(f=this.u.wa[2],j=20*(g.owner+1)),i.drawImage(f,j,0,20,20,-k*g.size,-k*g.size,this.scale*g.size,this.scale*g.size),i.restore()):g.owner===
u?(h=k,g.size!==1&&(h*=g.size),i.beginPath(),i.arc(g.x+k,g.y+k,h,0,2*Math.PI,!1),i.fill()):(h=this.scale,f=g.x,j=g.y,g.size!==1&&(l=0.5*(1-g.size)*this.scale,f+=l,j+=l,h*=g.size),i.fillRect(f,j,h,h),f<0&&(i.fillRect(f+r,j,h,h),j<0&&i.fillRect(f+r,j+n,h,h)),j<0&&i.fillRect(f,j+n,h,h))}if(this.n.label){i.save();i.translate(k,k);g=Math.max(this.scale,8);i.textBaseline="middle";i.textAlign="center";i.font="bold "+Math.ceil(g/this.n.label)+"px Arial";i.fillStyle="#000";i.strokeStyle="#fff";i.lineWidth=
0.2*g;for(e in p){s=p[e];for(t=0;t<s.length;t++)g=s[t],f=this.n.label===1&&g.owner!==u?String.fromCharCode(65+g.owner):this.n.label===2?g.id:u,f!==u&&(i.strokeText(f,g.x,g.y),i.fillText(f,g.x,g.y),g.x<0&&(i.strokeText(f,g.x+this.c.map.d,g.y),i.fillText(f,g.x+this.c.map.d,g.y),g.y<0&&(i.strokeText(f,g.x+this.c.map.d,g.y+this.c.map.e),i.fillText(f,g.x+this.c.map.d,g.y+this.c.map.e))),g.y<0&&(i.strokeText(f,g.x,g.y+this.c.map.e),i.fillText(f,g.x,g.y+this.c.map.e)))}i.restore()}if(this.la)var v=Math.round(this.scale*
this.Za)+c+this.scale-1,v=Math.Da(v,r)-this.scale+1,A=Math.round(this.scale*this.$a)+d+this.scale-1,A=Math.Da(A,n)-this.scale+1;c=this.scale*Math.sqrt(this.a.h.replaydata.attackradius2);d=this.scale*Math.sqrt(this.a.h.replaydata.spawnradius2);i.save();i.translate(k,k);i.lineWidth=2*this.scale/20;for(g=0;g<q.length;g++)if(t=q[g],t.owner!==u)for(n=g+1;n<q.length;n++)if(r=q[n],r.owner!==u&&t.owner!==r.owner&&(f=t.ha-r.ha,j=t.ia-r.ia,f=2*f>+this.a.cols?f-this.a.cols:2*f<-this.a.cols?this.a.cols-f:f,j=
2*j>+this.a.rows?j-this.a.rows:2*j<-this.a.rows?this.a.rows-j:j,f*f+j*j<=this.a.h.replaydata.attackradius2))i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(t.x-f*k,t.y-j*k),i.strokeStyle=this.a.M[r.owner],i.stroke(),i.beginPath(),i.moveTo(r.x,r.y),i.lineTo(r.x+f*k,r.y+j*k),i.strokeStyle=this.a.M[t.owner],i.stroke();if(this.la)for(e in p){i.strokeStyle="#"+e;s=p[e];for(t=0;t<s.length;t++)g=s[t],q=g.owner!==u?c:d,f=g.x-v,j=g.y-A,q*q>=f*f+j*j&&(i.beginPath(),i.arc(g.x,g.y,q,0,2*Math.PI,!1),i.moveTo(g.x,g.y),
i.lineTo(v,A),i.stroke())}i.restore();this.A&&i.drawImage(this.aa.canvas,0,0);if(this.la)i.strokeStyle="#fff",i.strokeRect(v+0.5,A+0.5,this.scale-1,this.scale-1);i=this.j.i;i.save();i.beginPath();i.rect(m.x,m.y,m.d,m.e);i.clip();this.border.canvas.width<m.d?(e=this.c.map.x-m.x+this.K,e+=m.x-Math.ceil(e/this.c.map.d)*this.c.map.d):e=m.x;this.border.canvas.height<m.e?(v=this.c.map.y-m.y+this.L,v+=m.y-Math.ceil(v/this.c.map.e)*this.c.map.e):v=m.y;for(j=v;j<m.y+m.e;j+=this.c.map.e)for(f=e;f<m.x+m.d;f+=
this.c.map.d)i.drawImage(this.border.canvas,f,j);i.restore();i.fillStyle="rgba(0,0,0,0.3)";h=this.c.map.y-m.y;h>0&&i.fillRect(m.x,m.y,m.d,h);h=m.y+m.e-this.c.map.y-this.c.map.e;h>0&&i.fillRect(m.x,this.c.map.y+this.c.map.e,m.d,h);h=this.c.map.x-m.x;h>0&&i.fillRect(m.x,m.y,h,m.e);h=m.x+m.d-this.c.map.x-this.c.map.d;h>0&&i.fillRect(this.c.map.x+this.c.map.d,m.y,h,m.e);if(this.n.zoom!==1&&this.F.c.e+4<=this.c.f.e&&this.F.c.d+4<=this.c.f.d)i.save(),i.strokeStyle="#fff",i.lineWidth=2,i.beginPath(),m=this.F.c,
i.rect(m.x-1,m.y-1,m.d+2,m.e+2),i.stroke(),i.drawImage(this.F.canvas,m.x,m.y,m.d,m.e),i.beginPath(),i.rect(m.x,m.y,m.d,m.e),i.clip(),h=this.c.f.d/this.scale,e=this.c.f.e/this.scale,f=this.a.cols/2-this.K/this.scale-h/2,j=this.a.rows/2-this.L/this.scale-e/2,f-=Math.floor(f/this.a.cols)*this.a.cols,j-=Math.floor(j/this.a.rows)*this.a.rows,i.beginPath(),i.rect(m.x+f,m.y+j,h,e),i.rect(m.x+f-this.a.cols,m.y+j,h,e),i.rect(m.x+f,m.y+j-this.a.rows,h,e),i.rect(m.x+f-this.a.cols,m.y+j-this.a.rows,h,e),i.stroke(),
i.restore();if(m=this.hint){if(i.measureText(m).width>this.c.f.d){do m=m.substr(0,m.length-1);while(m&&i.measureText(m+"...").width>this.c.f.d);m&&(m+="...")}h=i.measureText(m).width;i.fillRect(this.c.f.x,this.c.f.y,h,20);i.fillStyle="#fff";i.fillText(m,this.c.f.x,this.c.f.y+10)}if(this.da){var x=this;window.setTimeout(function(){if(x.da)if(x.da=stream.ec(),x.W===LoadingState.LOADING){if(x.a.duration>0)x.k.qa=1,ga(x)}else{ua(x);wa(x,!0);resume=x.k.C===0&&x.k.position===x.k.duration;if(x.k.X===x.k.duration)x.k.X=
x.a.duration;x.k.duration=x.a.duration;resume&&x.k.play()}},0)}};
function va(a,b,c){var d=b-a.N,h=c-a.P;a.N=b;a.P=c;a.Za=Math.Da(b-a.c.map.x-a.K,a.scale*a.a.cols)/a.scale|0;a.$a=Math.Da(c-a.c.map.y-a.L,a.scale*a.a.rows)/a.scale|0;var e=a.hint;a.hint="";if(a.options.interactive){a.la=a.c.map.contains(a.N,a.P)&&a.c.f.contains(a.N,a.P);if(a.la)a.hint="row "+a.$a+" | col "+a.Za;if(a.B===1)b=(a.N-a.c.H.x)/(a.c.H.d-1),b=Math.round(b*(a.a.fa.length-1)),N(a.k,b);else if(a.B===2||a.B===3&&a.F.c.contains(a.N,a.P))a.B===2?(a.K+=d,a.L+=h):(a.K=(a.a.cols/2-(a.N-a.F.c.x))*a.scale,
a.L=(a.a.rows/2-(a.P-a.F.c.y))*a.scale),b=P(a.m.p.toolbar,4),b.enabled=a.K||a.L,b.l(),a.k.l();else var f=a.m.Z(b,c)}else f=a.m.Z(b,c);if(f&&f.hint)a.hint=f.hint;e!==a.hint&&a.k.l()}Visualizer.prototype.loadReplayData=Visualizer.prototype.Db;Visualizer.prototype.loadReplayDataFromPHP=Visualizer.prototype.ac;Visualizer.prototype.loadReplayDataFromURI=Visualizer.prototype.Eb;function T(a,b){this.w=a;this.onclick=b;this.G=this.t=!1;this.enabled=!!b}
T.prototype.l=function(){var a=this.w,b=a.Wa.f.j.i,c=this.ua(),d=c.d>a.x+a.d-c.x?a.x+a.d-c.x:c.d,a=c.e>a.y+a.e-c.y?a.y+a.e-c.y:c.e;if(!(d<=0||a<=0)){b.save();b.fillStyle="#fff";b.fillRect(c.x,c.y,d,a);if(!this.enabled)b.globalAlpha=0.5;b.beginPath();b.moveTo(c.x,c.y);b.lineTo(c.x+d,c.y);b.lineTo(c.x+d,c.y+a);b.lineTo(c.x,c.y+a);b.closePath();b.clip();d=0.2*Math.min(c.d,c.e);if(this.onclick&&this.enabled){if(this.t||this.G)Aa(b,c.x,c.y,c.d,c.e,d),b.fillStyle="rgb(255, 230, 200)",b.fill();this.G?b.shadowBlur=
1:(b.shadowBlur=4,b.shadowOffsetX=-2,b.shadowOffsetY=2);b.shadowColor="rgba(0, 0, 0, 0.7)"}b.save();b.translate(c.x,this.G?c.y+1:c.y-1);this.Sa(b);b.restore();if(this.onclick&&this.enabled&&(this.t||this.G))b.shadowColor="rgba(0, 0, 0, 0)",b.lineWidth=2,b.strokeStyle="#444",b.stroke();b.restore()}};T.prototype.B=function(){switch(this.w.mode){case Q:if(this.G)break;for(var a=this.w.v,b=0;b<a.length;b++)if(a[b].G)a[b].G=!1,a[b].l();case M:this.G=!0,this.l()}};
T.prototype.U=function(){switch(this.w.mode){case M:this.G=!1,this.l()}};function U(a,b){this.v=[];this.Wa=a;this.border=b?b:0}var M=1,Q=2;U.prototype.l=function(){for(var a=0;a<this.v.length;a++)this.v[a].l&&this.v[a].l()};U.prototype.Z=function(a,b){for(var c=0;c<this.v.length;c++)if(this.v[c].ua&&this.v[c].ua().contains(a,b))return this.v[c].enabled?this.v[c]:w;return w};function Da(a,b,c,d,h,e){T.apply(this,[a,h]);this.xb=b;this.ab=c;this.ra=d;this.hint=e}y=Da.prototype;y.l=T.prototype.l;
y.Sa=function(a){var b=this.w.border,c=this.w.size-2*this.w.border;a.drawImage(this.w.yb,this.ab,0,c,c,b,b,c,c)};y.ua=function(){return new Location(this.w.x+(this.w.Ba?0:this.ra),this.w.y+(this.w.Ba?this.ra:0),this.w.size,this.w.size)};y.U=T.prototype.U;y.B=T.prototype.B;function L(a,b,c,d,h,e){U.apply(this,[a,h]);this.yb=b;this.Ba=c;this.mode=d;this.size=b.height+2*this.border;this.y=this.x=0;this.d=this.Ba?this.size:e;this.e=this.Ba?e:this.size}var la=!1,oa=!0;L.prototype=new U;
L.prototype.l=function(){U.prototype.l.apply(this,[])};function Ea(a){if(a.v.length!==0){var b=a.v[a.v.length-1];return b.ra+(b.size||a.size)}return 0}L.prototype.z=function(a,b,c){a=new Da(this,a,(this.size-2*this.border)*a,Ea(this),b,c);this.v.push(a);return a};function O(a,b){a.v.push({ra:Ea(a),size:b})}function P(a,b){for(var c=0;c<a.v.length;c++)if(a.v[c].xb===b)return a.v[c];return w}
function Fa(a,b,c,d){T.apply(this,[a,d]);this.text=b;this.color=c;a=this.w.Wa.f.j.i;this.y=this.x=0;a.font="bold 19px Arial,Sans";this.d=a.measureText(b).width+8;this.e=28}y=Fa.prototype;y.l=T.prototype.l;y.Sa=function(a){a.shadowColor="#532";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=2;a.textAlign="left";a.textBaseline="bottom";a.font="bold 19px Arial,Sans";a.fillStyle=this.color;a.fillText(this.text,4,25)};y.ua=function(){return new Location(this.w.x+this.x,this.w.y+this.y,this.d,this.e)};
y.U=T.prototype.U;y.B=T.prototype.B;function R(a,b,c,d){U.apply(this,[a,d]);this.$b=b;this.mode=c;this.y=this.x=0;this.d=this.e=u}var ya=!1;R.prototype.z=function(a,b,c){a=new Fa(this,a,b,c);this.v.push(a);return a};R.prototype.l=U.prototype.l;R.prototype.Z=U.prototype.Z;function G(a){this.f=a;this.p={};this.Q=this.t=w}G.prototype.l=function(){for(var a in this.p)this.p[a].mode!==0&&this.p[a].l()};
G.prototype.Z=function(a,b){var c=w,d;for(d in this.p){var h=this.p[d];if(h.mode!=0&&b>=h.y&&b<h.y+h.e&&a>=h.x&&a<h.x+h.d&&(c=h.Z(a,b),c!==w))break}if(this.t!==c){if(this.t&&(this.t.t||this.t.G))this.t.t=!1,this.t.G&=this.t.w.mode==Q,this.t.l();if(c&&(!this.Q||this.Q===c)&&!c.t)c.t=!0,c.G=c===this.Q||c.G&&(!this.t||this.t.w.mode==Q),c.l();this.t=c}return c};G.prototype.U=function(){if(this.Q){this.Q.U();if(this.Q==this.t)this.Q.onclick();this.Q=w}};
G.prototype.B=function(){if(this.t&&this.t.enabled)this.t.B(),this.Q=this.t};function Aa(a,b,c,d,h,e){var f=0.5*Math.PI;a.beginPath();a.moveTo(b+e+1,c+1);a.lineTo(b+d-e-1,c+1);a.arc(b+d-e-1,c+e+1,e,-f,0,!1);a.lineTo(b+d-1,c+h-e-1);a.arc(b+d-e-1,c+h-e-1,e,0,f,!1);a.lineTo(b+e+1,c+h-1);a.arc(b+e+1,c+h-e-1,e,f,2*f,!1);a.lineTo(b+1,c+e+1);a.arc(b+e+1,c+e+1,e,2*f,3*f,!1)};function F(a){this.load();if(a)for(var b in a)this[b]=a[b]}F.prototype.fullscreen=!1;F.prototype.label=0;F.prototype.graphics=!1;F.prototype.zoom=1;F.prototype.duration=100;F.prototype.speedSlowest=2;F.prototype.speedFastest=5;F.prototype.speedFactor=0;F.prototype.cpu=0.5;function pa(){try{return!!window.localStorage}catch(a){return a}}
F.prototype.save=function(){if(pa()===!0){for(var a in this)if(this[a]===u||this[a]===F.prototype[a])delete window.localStorage["visualizer."+a];else if(this[a]===w)window.localStorage["visualizer."+a]="null";else{var b=u;switch(typeof this[a]){case "number":b="N";break;case "boolean":b="B";break;case "string":b="S";break;case "function":break;default:o("Only numbers, booleans and strings can be saved in the config")}b&&(window.localStorage["visualizer."+a]=b+this[a])}return!0}return!1};
F.prototype.load=function(){if(pa()===!0){for(var a in this){var b=window.localStorage["visualizer."+a];if(typeof this[a]!="function"&&b)if(b==="null")this[a]=w;else switch(b.charAt(0)){case "N":this[a]=Number(b.substr(1));break;case "B":this[a]=b=="Btrue";break;case "S":this[a]=b.substr(1)}}return!0}return!1};for(var V=[200,150,100],Ga=[[240,0,0],[255,0,255],[0,210,210],[118,116,53],[100,220,0],[211,103,18],[23,24,137],[49,110,130],[175,139,226],[117,137,121],[51,83,33],[118,26,66],[94,76,169],[112,110,119],[46,133,36],[30,85,213],[242,147,1],[145,179,156],[115,83,56],[165,45,151],[110,124,65],[208,130,107],[131,145,182],[49,160,115],[156,126,144],[137,62,187]],S=Array(256),W=0;W<16;W++)S[W]="0"+W.toString(16);for(;W<256;W++)S[W]=W.toString(16);function ba(a){this.position=this.C=0;this.V=u;this.f=a;this.duration=0;this.Fa=1;this.X=u;this.qa=a.n.cpu;this.ta=this.ja=this.sa=this.timeout=this.$=u;this.Ia=!1}y=ba.prototype;y.play=function(){if(this.C===0){if(this.position===this.duration)this.position=0;this.C=this.Fa;this.X=this.duration;this.$&&this.$();this.loop(0);this.f.options.profile&&console.profile()}};y.stop=function(){if(this.C!==0)this.f.options.profile&&console.bc(),this.C=0,this.V=u,this.$&&this.$()};
function N(a,b){a.stop();if(b<0)b=0;else if(b>a.duration)b=a.duration;if(a.position!=b){var c=a.position|0;a.position=b;b|=0;a.f.l(a.position,c!==b)}}function na(a,b){if(b<0)b=0;else if(b>a.duration)b=a.duration;a.X=b;var c=a.C!==0;a.C=a.position<b?1:-1;c||(a.$&&a.$(),a.loop(0))}
y.loop=function(a){if(this.C!==0){var b=this.V;this.V=(new Date).getTime();var c=this.position|0;if(b===u)var d=u,c=-1;else d=this.V-b-a,this.position+=(this.V-b)*this.C*0.001;var h=!0;if(this.C<0&&this.position<=this.X)this.position=this.X,h=!1,this.stop();else if(this.C>0&&this.position>=this.X)this.position=this.X,h=!1,this.stop();this.f.l(this.position,this.Ia||c!=(this.position|0));this.Ia=!1;if(h){if(this.f.options.debug&&d!==u){if(this.ja===u)this.ja=b,this.ta=this.sa=0;this.sa++;this.ta+=
d;if(this.V>=this.ja+1E3)b=this.V-this.ja,document.title=Math.round(1E3*this.sa/b)+" fps @ "+Math.round(100*this.ta/b)+"% cpu",this.ja=this.V,this.ta=this.sa=0}var e=this;(b=this.qa<=0||this.qa>1||d===u)?e.timeout=window.setTimeout(function(){e.loop(a)},0):(a=b?0:Math.ceil(d/this.qa-d),this.timeout=window.setTimeout(function(){e.timeout=window.setTimeout(function(){e.loop(a)},a)},0))}}};y.ba=function(){window.clearTimeout(this.timeout);this.stop();this.position=0};
y.l=function(a){this.C!==0?a?(window.clearTimeout(this.timeout),this.loop(0)):this.Ia=!0:this.f.l(this.position,!0)};function Ha(a){this.src=a;this.Aa=u}function H(a,b,c){this.vb=a;this.f=b;this.sb=c;this.info=[];this.images=[];this.wa=[];this.error="";this.xa=0;this.Qa=!0;this.cb=!1}H.prototype.add=function(a){this.info.push(new Ha(this.vb+a));this.images.push(w);this.wa.push(w)};H.prototype.ba=function(){for(var a=0;a<this.images.length;a++)if(this.info[a].Aa===!1)this.info[a].Aa=u,this.images[a]=w,this.xa++;ca(this)};
function ca(a){var b;a.error="";for(var c=0;c<a.images.length;c++)if(a.info[c].Aa===u&&!a.images[c]){b=new Image;a.images[c]=b;var d=a;b.onload=function(){d.Ga(this,!0)};b.onerror=function(){d.Ga(this,!1)};b.onabort=b.onerror;b.src=a.info[c].src;a.xa++}}H.prototype.Ga=function(a,b){var c;for(c=0;c<this.images.length;c++)if(this.images[c].src===a.src)break;b||(this.error&&(this.error+="\n"),this.error+=this.info[c].src+" did not load.");this.info[c].Aa=b;--this.xa==0&&this.sb.apply(this.f,[this.error])};
function sa(a,b,c){var d={};K(d);a.wa[b]=d.canvas;d.canvas.width=a.images[b].width*c.length;d.canvas.height=a.images[b].height;var h=d.i;h.fillStyle=h.createPattern(a.images[b],"repeat");h.fillRect(0,0,d.canvas.width,d.canvas.height);if(!a.cb){try{var e=h.getImageData(0,0,d.canvas.width,d.canvas.height)}catch(f){try{var j=netscape.dc.Ub;if(a.Qa)a.Qa=!1;j.Xb("UniversalBrowserRead");e=h.getImageData(0,0,d.canvas.width,d.canvas.height)}catch(l){a.cb=!0;return}}d=e.data;j=0;a=4*a.images[b].width;for(b=
0;b<c.length;b++){var k=c[b];if(k){typeof k=="string"&&(k=[15*parseInt(k.charAt(1),16),15*parseInt(k.charAt(2),16),15*parseInt(k.charAt(3),16)]);for(var g=0;g<4*e.width*e.height;g+=4*e.width)for(var q=g+j;q<g+j+a;q+=4)d[q]===d[q+1]&&d[q]===d[q+2]&&(d[q+0]=d[q+0]*k[0]>>8,d[q+1]=d[q+1]*k[1]>>8,d[q+2]=d[q+2]*k[2]>>8)}j+=a}h.putImageData(e,0,0)}}H.prototype.imgHandler=H.prototype.Ga;Random={cc:function(a){return Math.random()*a|0},Yb:function(a,b){return a+(Math.random()*(1+b-a)|0)}};Math.Da=function(a,b){return a-Math.floor(a/b)*b};ParameterType={NONE:0,oa:1,T:2,Na:3,Lb:4,Ob:5,Mb:6,Nb:7};function X(a,b){this.x=a;this.y=b;this.Pa=Math.atan2(a,-b)}Directions={Ka:new X(0,-1),Qb:new X(1,-1),E:new X(1,0),Vb:new X(1,1),Ma:new X(0,1),Wb:new X(-1,1),Oa:new X(-1,0),Sb:new X(-1,-1)};
DataType={oa:function(a){return[a,w]},ib:function(a){a=a.match(DataType.ga);return[a[1],a[2]]},T:function(a,b){a=a.match(DataType.ga);a=[parseInt(a[1]),a[2]];(isNaN(a[0])||a[0]<0)&&o(Error("Parameter "+b+" must be an unsigned integer."));return a},La:function(a,b){a=DataType.T(a,b);a[0]<=0&&o(Error("Parameter "+b+" must be a positive integer."));return a},Rb:function(a,b){a=a.match(DataType.ga);a=[parseFloat(a[1]),a[2]];isNaN(a[0])&&o(Error("Parameter "+b+" is not a number."));return a},Pb:function(a,
b){a=a.match(DataType.ga);a[1]||o(Error("Parameter "+b+" must not be empty."));a[0]=Array(a[1].length);for(var c=0;c<a[1].length;c++){var d=a[1].charAt(c);d!=="%"&&d!=="*"&&d!=="."&&(d<"a"||d>"z")&&o(Error("Invalid character in map line: "+d));a[0][c]=d==="%"}return[a[0],a[2]]},Tb:function(a){a=a.match(DataType.ga);a[1]=a[1].split("");a[0]=Array(a[1].length);for(var b=0;b<a[1].length;b++)switch(a[1][b]){case "n":case "N":a[0][b]=Directions.Ka;break;case "e":case "E":a[0][b]=Directions.E;break;case "s":case "S":a[0][b]=
Directions.Ma;break;case "w":case "W":a[0][b]=Directions.Oa;break;case "-":a[0][b]=w;break;default:o(Error("Invalid character in orders line: "+a[1][b]))}return[a[0],a[2]]},Na:function(a){for(var a=a.replace(/\s+/g," ").replace(/\s*$/,"").split(" "),b=0;b<a.length;b++)a[b]=parseFloat(a[b]),isNaN(a[b])&&o(Error("Score "+b+" is not a number."));return[a,w]},ga:/(\S*)\s*(.*)/};
function ha(a,b,c){var d,h,e="json";this.ca=b||!1;if(a===u)this.h={challenge:"ants",replayformat:e,replaydata:{map:{}}},this.duration=-1,this.J=!0,this.pa=[];else{a=a.search(/^\s*{/)===-1?Ia(this,a):JSON.parse(a);if(a.challenge===u)this.h={challenge:"ants",replayformat:e,replaydata:a};else{this.h=a;if(typeof this.h.replaydata=="string")e="storage",this.h.replaydata=Ia(this,this.h.replaydata);a=this.h.replaydata}this.h.challenge!=="ants"?o(Error('This visualizer is for the ants challenge, but a "'+
this.h.challenge+'" replay was loaded.')):this.h.replayformat!==e&&o(Error('Replays in the format "'+this.h.replayformat+'" are not supported.'));a||o(Error("replay meta data is no object notation"));this.duration=0;var f=this;if(a){var j=[];d=function(a,b,c){a[b]!==c&&!f.ca&&o(Error(j.join(".")+"."+b+" should be "+c+", but was found to be "+a[b]+"!"))};var l=function(a,b,c,d){!(a[b]>=c&&(a[b]<=d||d===u))&&!f.ca&&o(Error(j.join(".")+"."+b+" should be within ["+c+" .. "+d+"], but was found to be "+
a[b]+"!"))},b=function(a,b,c,d){a[b]instanceof Array||o(Error(j.join(".")+"."+b+" should be an array, but was found to be of type "+typeof a[b]+"!"));j.push(b);l(a[b],"length",c,d);j.pop()},k=function(a,b,c,d){typeof a[b]!=="string"&&o(Error(j.join(".")+"."+b+" should be a string, but was found to be of type "+typeof a[b]+"!"));j.push(b);l(a[b],"length",c,d);j.pop()},g=function(a,b,c,d,e){a[b]===u&&(a[b]=c);d.apply(u,[a,b].concat(e))},q=function(a,b){a[b]instanceof Object||o(Error(j.join(".")+"."+
b+" should be an object, but was found to be of type "+typeof a[b]+"!"));j.push(b);return a[b]},m=w,e=function(a,b){m?(!b&&f.duration<a||b&&f.duration!==a&&!f.ca)&&o(Error("Replay duration was previously set to "+f.duration+' by "'+m+'" and is now redefined to be '+a+' by "'+i+'"')):(f.duration=a,b&&(m=i))};q(this.h,"replaydata");d(a,"revision",2);l(a,"players",1,26);this.s=a.players;(function(a,b,c,d){a[b]!==u&&c.apply(u,[a,b].concat(d))})(a,"viewradius2",l,[0,u]);var p=q(a,"map");b(p,"data",1,u);
j.push("data");k(p.data,0,1,u);j.pop();g(p,"rows",p.data.length,d,[p.data.length]);this.rows=p.rows;g(p,"cols",p.data[0].length,d,[p.data[0].length]);this.cols=p.cols;q=q(p,"data");this.Ca=Array(q.length);for(var g=/[^%*.a-z]/,n=0;n<q.length;n++){k(q,n,p.cols,p.cols);var r=new String(q[n]);(d=r.search(g))!==-1&&!this.ca&&o(Error('Invalid character "'+r.charAt(d)+'" in map. Zero based row/col: '+n+"/"+d));this.Ca[n]=Array(r.length);for(d=0;d<r.length;d++)this.Ca[n][d]=r.charAt(d)==="%"}j.pop();j.pop();
b(a,"ants",0,u);j.push("ants");q=a.ants;g=/[^nsew-]/;for(n=0;n<q.length;n++){b(q,n,4,7);j.push(n);var i=q[n];l(i,0,0,p.rows-1);l(i,1,0,p.cols-1);l(i,2,0,u);i[2]===0?l(i,3,0,u):l(i,3,i[2]+1,u);i.length>4?(l(i,4,i[3]+1,u),l(i,5,0,this.s-1),d=i[4]-i[3],k(i,6,d-1,d),e(i[4]-1,i[6].length!==d),(d=i[6].search(g))!==-1&&!this.ca&&o(Error('Invalid character "'+i[6].charAt(d)+'" in move orders at index '+d+' in the string "'+i[6]+'"'))):e(i[3]-1,!1);j.pop()}b(a,"scores",this.s,this.s);j.push("scores");k=a.scores;
for(d=0;d<this.s;d++)e(k[d].length-1,!1);a.bonus&&b(a,"bonus",this.s,this.s);this.fa=Array(this.duration+1);this.I=Array(this.duration+1);this.S=Array(this.duration+1);this.Ta=Array(this.s);for(n=0;n<=this.duration;n++){this.I[n]=Array(this.s);this.S[n]=Array(this.s);for(d=0;d<this.s;d++)this.S[n][d]=0}for(d=0;d<this.s;d++){b=k[d];for(a=0;a<b.length;a++)this.I[a][d]=b[a];for(;a<=this.duration;a++)this.I[a][d]=b[b.length-1];this.Ta[d]=Array(this.duration+1)}for(d=0;d<q.length;d++)if(q[d][5]!==u)for(n=
q[d][3];n<q[d][4];n++)this.S[n][q[d][5]]++;this.pa=Array(q.length)}this.J=this.duration>0||this.h.replaydata.turns>0;this.h.user_ids&&(h=this.h.user_ids.indexOf(c,0),h===-1&&(h=u));Ja(this,h)}}
function Ja(a,b){var c;if(!(a.h.playernames instanceof Array))a.h.players instanceof Array?(a.h.playernames=a.h.players,delete a.h.players):a.h.playernames=Array(a.s);a.h.playercolors instanceof Array||(a.h.playercolors=Array(a.s));for(c=0;c<a.s;c++)a.h.playernames[c]||(a.h.playernames[c]="player "+(c+1)),a.h.playercolors[c]instanceof Array||(a.h.playercolors[c]=b!==u&&c==0?Ga[b]:b!==u&&c==b?Ga[0]:Ga[c]);a.M=Array(a.s);for(c=0;c<a.s;c++)a.M[c]="#",a.M[c]+=S[a.h.playercolors[c][0]],a.M[c]+=S[a.h.playercolors[c][1]],
a.M[c]+=S[a.h.playercolors[c][2]]}
function Ia(a,b){var c,d,h,e,f,j,l,k,g,q,m,p,n,r,i,s,t,v;h=new Ka(b);t={revision:2,map:{data:[]},ants:[],scores:[]};a.fa=[];try{e=Y(h);if(v=e.D==="v")Z(La(e,"v"),[DataType.ib,DataType.La]),"ants"!==e.q[0]&&$("ants",e.q[0]),1!==e.q[1]&&$(1,e.q[1]),e=Y(h),Z(La(e,"players"),[DataType.La]),26<e.q[0]&&$("parameter 0 to be <= 26",e.q[0]),t.players=e.q[0],e=Y(h);for(;e.D!=="m";){f=[DataType.oa];if(e.D==="viewradius2"||e.D==="rows"||e.D==="cols"||e.D==="players"||e.D==="turns")f[0]=DataType.T;Z(e,f);e.D===
"rows"||e.D==="cols"?t.map[e.D]=e.q[0]:t[e.D]=e.q[0];e=Y(h)}l=u;j=0;do{Z(e,[DataType.oa]);l===u?l=e.q[0].length:e.q[0].length!==l&&!a.ca&&o(Error("Map lines have different lenghts"));t.map.data.push(e.q[0]);if(!v)for(c=0;c<l;c++)d=e.q[0].charAt(c),d>="a"&&d<="z"?t.ants.push([j,c,0,0,1,d.toUpperCase().charCodeAt(0)-65,"-"]):d==="*"&&t.ants.push([j,c,0,0]);j++;if(v||h.ya<h.na.length)e=Y(h);else break}while(e.D==="m");if(v){for(;e.D==="a";)Z(e,[DataType.T,DataType.T,DataType.T,DataType.T,DataType.T,
DataType.T,DataType.oa],3),g=e.q[0],g>=a.rows&&o(Error("Row exceeds map width.")),q=e.q[1],q>=a.cols&&o(Error("Col exceeds map height.")),p=e.q[3],n=e.q[4],n===u&&(n=p),k=e.q[5],(m=k!==u)&&k>=a.s&&o(Error("Player index out of range.")),e.q.length===6&&e.q.push(""),r=e.q[6],m&&(i=r.length!==n-p)&&r.length+1!==n-p&&o(Error("Number of orders does not match life span.")),t.ants.push(e.q),e=Y(h);var A=a.s||t.players;for(c=0;c<A;c++)s=Z(La(e,"s"),[DataType.Na]).q[0],t.scores.push(s),c!=A-1&&(e=Y(h))}else for(c=
0;c<t.players;c++)t.scores.push([0]);h.ya<h.na.length&&(e=Y(h),o(Error("Extra data at end of file.")))}catch(x){x.message=e.Bb+"\n"+x.message,o(x)}return t}
function Ba(a,b){var c,d,h,e,f,j;if(a.fa[b]===u){b!==0&&Ba(a,b-1);d=a.fa[b]=[];h=a.h.replaydata.ants;for(c=0;c<h.length;c++){e=h[c];if(e[2]===b+1||b===0&&e[2]===0){f=e[0];j=e[1];var l=e[2],k=e[5],g=a.pa[c]=new aa(c,l-0.25);g.Fb=k;k=C(g,l-0.25,Quality.O);k.x=j;k.y=f;k.r=V[0];k.g=V[1];k.b=V[2];if(l!==0)k=C(g,l,Quality.O),k.size=1,k=C(g,l+0.125,Quality.O),k.size=1.5,k=C(g,l+0.25,Quality.O),k.size=0.7,k=C(g,l+0.5,Quality.O);k.size=1;f=g}else if(a.pa[c])f=a.pa[c];else continue;if(e[5]!==u&&(e[3]===b+1||
b===0&&e[3]===0))j=f,l=e[3],g=e[5],k=a.h.playercolors[g],e[3]!=e[2]&&(D(j,"r",255,l-0.5,l-0.25),D(j,"g",255,l-0.5,l-0.25),D(j,"b",255,l-0.5,l-0.25)),C(j,l-0.25,Quality.O).owner=g,D(j,"r",k[0],l-0.25,l),D(j,"g",k[1],l-0.25,l),D(j,"b",k[2],l-0.25,l);if(e[6]!==u&&b>=e[3]&&b<e[3]+e[6].length){C(f,b,Quality.O).owner=e[5];l=u;switch(e[6].charAt(b-e[3])){case "n":case "N":l=Directions.Ka;break;case "e":case "E":l=Directions.E;break;case "s":case "S":l=Directions.Ma;break;case "w":case "W":l=Directions.Oa}l&&
(j=f.ea[f.ea.length-1],D(f,"x",j.x+l.x,b,b+0.5),D(f,"y",j.y+l.y,b,b+0.5))}e=e[4]||e[3];if(e===b+1)j=a,l=f,g=e,k=u,k=C(l,g,Quality.O).owner,k=k===u?V:j.h.playercolors[k],D(l,"r",255,g-0.8,g-0.6),D(l,"g",255,g-0.8,g-0.6),D(l,"b",255,g-0.8,g-0.6),D(l,"r",k[0],g-0.6,g-0.4),D(l,"g",k[1],g-0.6,g-0.4),D(l,"b",k[2],g-0.6,g-0.4),D(l,"r",0,g-0.4,g),D(l,"g",0,g-0.4,g),D(l,"b",0,g-0.4,g),D(l,"size",0.7,g-0.8,g-0.6),D(l,"size",0,g-0.4,g);b<e&&d.push(f)}}return a.fa[b]}
function Ka(a){this.text=a;this.Ha=a.replace(Ma,"").split("\n");this.na=Array(this.Ha.length);for(a=0;a<this.Ha.length;a++)this.na[a]=new Na(this.Ha[a]);this.ya=0}function Y(a){if(a.ya<a.na.length)return a.na[a.ya++];o(Error("Tried to read past the end of the file. Is it truncated?"))}function Na(a){this.Bb=a;a=a.match(Oa);this.D=a[1].toLowerCase();this.q=a[2]}var Ma=/^([^\S\n]*(#.*)?\n)*|(\n[^\S\n]*(#.*)?)*$|\n[^\S\n]*(#.*)?(?=\n)/g,Oa=/(\S+)\s*(.*)/;function La(a,b){a.D!==b&&$(b,a.D);return a}
function Z(a,b,c){c===u&&(c=0);var d=a.q;a.q=[];for(var h=0;h<b.length;h++)if(d||b.length-h>c)d=b[h](d),a.q.push(d[0]),d=d[1];d&&o(Error("The following unexpected additional parameter was found: "+d));return a}function $(a,b){o(Error("Expected "+a+", but "+b+" found."))};
